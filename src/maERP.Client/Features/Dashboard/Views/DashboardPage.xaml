<Page x:Class="maERP.Client.Features.Dashboard.Views.DashboardPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:maERP.Client.Features.Dashboard.Views"
      xmlns:models="using:maERP.Client.Features.Dashboard.Models"
      xmlns:mvux="using:Uno.Extensions.Reactive.UI"
      xmlns:utu="using:Uno.Toolkit.UI"
      NavigationCacheMode="Required"
      Background="{ThemeResource BackgroundBrush}">

  <Page.Resources>
    <SolidColorBrush x:Key="PositiveChangeBrush" Color="#16A34A" />
    <SolidColorBrush x:Key="NegativeChangeBrush" Color="#DC2626" />
    <SolidColorBrush x:Key="CriticalAlertBrush" Color="#DC2626" />
    <SolidColorBrush x:Key="WarningAlertBrush" Color="#F59E0B" />
  </Page.Resources>

  <ScrollViewer VerticalScrollBarVisibility="Auto">
    <Grid utu:SafeArea.Insets="VisibleBounds"
          Padding="24">

      <!-- VisualStateManager for responsive layout -->
      <VisualStateManager.VisualStateGroups>
        <VisualStateGroup>
          <VisualState x:Name="Narrow">
            <VisualState.StateTriggers>
              <AdaptiveTrigger MinWindowWidth="0" />
            </VisualState.StateTriggers>
            <VisualState.Setters>
              <Setter Target="ActivityGrid.MaxWidth" Value="600" />
              <Setter Target="ActivityColumn1.Width" Value="*" />
              <Setter Target="ActivityColumn2.Width" Value="0" />
              <Setter Target="RecentOrdersCard.(Grid.Column)" Value="0" />
              <Setter Target="RecentOrdersCard.(Grid.Row)" Value="0" />
              <Setter Target="RecentOrdersCard.Margin" Value="0,0,0,16" />
              <Setter Target="TopProductsCard.(Grid.Column)" Value="0" />
              <Setter Target="TopProductsCard.(Grid.Row)" Value="1" />
              <Setter Target="TopProductsCard.Margin" Value="0" />
            </VisualState.Setters>
          </VisualState>

          <VisualState x:Name="Medium">
            <VisualState.StateTriggers>
              <AdaptiveTrigger MinWindowWidth="800" />
            </VisualState.StateTriggers>
            <VisualState.Setters>
              <Setter Target="ActivityGrid.MaxWidth" Value="1200" />
              <Setter Target="ActivityColumn1.Width" Value="*" />
              <Setter Target="ActivityColumn2.Width" Value="*" />
              <Setter Target="RecentOrdersCard.(Grid.Column)" Value="0" />
              <Setter Target="RecentOrdersCard.(Grid.Row)" Value="0" />
              <Setter Target="RecentOrdersCard.Margin" Value="0,0,8,0" />
              <Setter Target="TopProductsCard.(Grid.Column)" Value="1" />
              <Setter Target="TopProductsCard.(Grid.Row)" Value="0" />
              <Setter Target="TopProductsCard.Margin" Value="8,0,0,0" />
            </VisualState.Setters>
          </VisualState>

          <VisualState x:Name="Wide">
            <VisualState.StateTriggers>
              <AdaptiveTrigger MinWindowWidth="1200" />
            </VisualState.StateTriggers>
            <VisualState.Setters>
              <Setter Target="ActivityGrid.MaxWidth" Value="10000" />
              <Setter Target="ActivityColumn1.Width" Value="*" />
              <Setter Target="ActivityColumn2.Width" Value="*" />
              <Setter Target="RecentOrdersCard.(Grid.Column)" Value="0" />
              <Setter Target="RecentOrdersCard.(Grid.Row)" Value="0" />
              <Setter Target="RecentOrdersCard.Margin" Value="0,0,8,0" />
              <Setter Target="TopProductsCard.(Grid.Column)" Value="1" />
              <Setter Target="TopProductsCard.(Grid.Row)" Value="0" />
              <Setter Target="TopProductsCard.Margin" Value="8,0,0,0" />
            </VisualState.Setters>
          </VisualState>
        </VisualStateGroup>
      </VisualStateManager.VisualStateGroups>

      <StackPanel Spacing="24">
        <!-- Page Header -->
        <StackPanel>
          <TextBlock x:Uid="DashboardPage.Header.Welcome"
                     Style="{StaticResource HeadlineMedium}"
                     Foreground="{ThemeResource OnBackgroundBrush}" />
          <TextBlock x:Uid="DashboardPage.Header.Subtitle"
                     Style="{StaticResource BodyMedium}"
                     Foreground="{ThemeResource OnSurfaceVariantBrush}"
                     Margin="0,4,0,0" />
        </StackPanel>

        <!-- KPI Cards Section using Grid with responsive columns - Each card loads independently -->
        <Grid x:Name="KpiGrid">
          <VisualStateManager.VisualStateGroups>
            <VisualStateGroup>
              <VisualState x:Name="KpiNarrow">
                <VisualState.StateTriggers>
                  <AdaptiveTrigger MinWindowWidth="0" />
                </VisualState.StateTriggers>
                <VisualState.Setters>
                  <!-- 1 column layout -->
                  <Setter Target="KpiColumn1.Width" Value="*" />
                  <Setter Target="KpiColumn2.Width" Value="0" />
                  <Setter Target="KpiColumn3.Width" Value="0" />
                  <Setter Target="KpiColumn4.Width" Value="0" />
                  <!-- Revenue: Row 0, Col 0 -->
                  <Setter Target="RevenueCardContainer.(Grid.Row)" Value="0" />
                  <Setter Target="RevenueCardContainer.(Grid.Column)" Value="0" />
                  <Setter Target="RevenueCardContainer.Margin" Value="0,0,0,16" />
                  <!-- Orders: Row 1, Col 0 -->
                  <Setter Target="OrdersCardContainer.(Grid.Row)" Value="1" />
                  <Setter Target="OrdersCardContainer.(Grid.Column)" Value="0" />
                  <Setter Target="OrdersCardContainer.Margin" Value="0,0,0,16" />
                  <!-- Customers: Row 2, Col 0 -->
                  <Setter Target="CustomersCardContainer.(Grid.Row)" Value="2" />
                  <Setter Target="CustomersCardContainer.(Grid.Column)" Value="0" />
                  <Setter Target="CustomersCardContainer.Margin" Value="0,0,0,16" />
                  <!-- Inventory: Row 3, Col 0 -->
                  <Setter Target="InventoryCardContainer.(Grid.Row)" Value="3" />
                  <Setter Target="InventoryCardContainer.(Grid.Column)" Value="0" />
                  <Setter Target="InventoryCardContainer.Margin" Value="0" />
                </VisualState.Setters>
              </VisualState>

              <VisualState x:Name="KpiMedium">
                <VisualState.StateTriggers>
                  <AdaptiveTrigger MinWindowWidth="600" />
                </VisualState.StateTriggers>
                <VisualState.Setters>
                  <!-- 2 column layout -->
                  <Setter Target="KpiColumn1.Width" Value="*" />
                  <Setter Target="KpiColumn2.Width" Value="*" />
                  <Setter Target="KpiColumn3.Width" Value="0" />
                  <Setter Target="KpiColumn4.Width" Value="0" />
                  <!-- Revenue: Row 0, Col 0 -->
                  <Setter Target="RevenueCardContainer.(Grid.Row)" Value="0" />
                  <Setter Target="RevenueCardContainer.(Grid.Column)" Value="0" />
                  <Setter Target="RevenueCardContainer.Margin" Value="0,0,8,16" />
                  <!-- Orders: Row 0, Col 1 -->
                  <Setter Target="OrdersCardContainer.(Grid.Row)" Value="0" />
                  <Setter Target="OrdersCardContainer.(Grid.Column)" Value="1" />
                  <Setter Target="OrdersCardContainer.Margin" Value="8,0,0,16" />
                  <!-- Customers: Row 1, Col 0 -->
                  <Setter Target="CustomersCardContainer.(Grid.Row)" Value="1" />
                  <Setter Target="CustomersCardContainer.(Grid.Column)" Value="0" />
                  <Setter Target="CustomersCardContainer.Margin" Value="0,0,8,0" />
                  <!-- Inventory: Row 1, Col 1 -->
                  <Setter Target="InventoryCardContainer.(Grid.Row)" Value="1" />
                  <Setter Target="InventoryCardContainer.(Grid.Column)" Value="1" />
                  <Setter Target="InventoryCardContainer.Margin" Value="8,0,0,0" />
                </VisualState.Setters>
              </VisualState>

              <VisualState x:Name="KpiWide">
                <VisualState.StateTriggers>
                  <AdaptiveTrigger MinWindowWidth="1100" />
                </VisualState.StateTriggers>
                <VisualState.Setters>
                  <!-- 4 column layout -->
                  <Setter Target="KpiColumn1.Width" Value="*" />
                  <Setter Target="KpiColumn2.Width" Value="*" />
                  <Setter Target="KpiColumn3.Width" Value="*" />
                  <Setter Target="KpiColumn4.Width" Value="*" />
                  <!-- Revenue: Row 0, Col 0 -->
                  <Setter Target="RevenueCardContainer.(Grid.Row)" Value="0" />
                  <Setter Target="RevenueCardContainer.(Grid.Column)" Value="0" />
                  <Setter Target="RevenueCardContainer.Margin" Value="0,0,8,0" />
                  <!-- Orders: Row 0, Col 1 -->
                  <Setter Target="OrdersCardContainer.(Grid.Row)" Value="0" />
                  <Setter Target="OrdersCardContainer.(Grid.Column)" Value="1" />
                  <Setter Target="OrdersCardContainer.Margin" Value="8,0,8,0" />
                  <!-- Customers: Row 0, Col 2 -->
                  <Setter Target="CustomersCardContainer.(Grid.Row)" Value="0" />
                  <Setter Target="CustomersCardContainer.(Grid.Column)" Value="2" />
                  <Setter Target="CustomersCardContainer.Margin" Value="8,0,8,0" />
                  <!-- Inventory: Row 0, Col 3 -->
                  <Setter Target="InventoryCardContainer.(Grid.Row)" Value="0" />
                  <Setter Target="InventoryCardContainer.(Grid.Column)" Value="3" />
                  <Setter Target="InventoryCardContainer.Margin" Value="8,0,0,0" />
                </VisualState.Setters>
              </VisualState>
            </VisualStateGroup>
          </VisualStateManager.VisualStateGroups>

          <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="KpiColumn1" Width="*" />
            <ColumnDefinition x:Name="KpiColumn2" Width="*" />
            <ColumnDefinition x:Name="KpiColumn3" Width="*" />
            <ColumnDefinition x:Name="KpiColumn4" Width="*" />
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>

          <!-- Revenue Card with FeedView -->
          <mvux:FeedView x:Name="RevenueCardContainer"
                         Grid.Row="0"
                         Grid.Column="0"
                         Margin="0,0,8,0"
                         Source="{Binding RevenueData}">
            <mvux:FeedView.ValueTemplate>
              <DataTemplate>
                <Border Background="{ThemeResource SurfaceBrush}"
                        CornerRadius="12"
                        Padding="20"
                        Translation="0,0,8">
                  <Border.Shadow>
                    <ThemeShadow />
                  </Border.Shadow>
                  <Grid>
                    <Grid.RowDefinitions>
                      <RowDefinition Height="Auto" />
                      <RowDefinition Height="Auto" />
                      <RowDefinition Height="Auto" />
                      <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="*" />
                      <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Border Grid.Row="0"
                            Grid.Column="1"
                            Background="{ThemeResource TertiaryContainerBrush}"
                            CornerRadius="20"
                            Width="40"
                            Height="40">
                      <FontIcon Glyph="&#xE7BF;"
                                FontSize="18"
                                Foreground="{ThemeResource OnTertiaryContainerBrush}"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                    </Border>

                    <TextBlock Grid.Row="0"
                               Grid.Column="0"
                               x:Uid="DashboardPage.KPI.Revenue"
                               Style="{StaticResource LabelLarge}"
                               Foreground="{ThemeResource OnSurfaceVariantBrush}" />
                    <TextBlock Grid.Row="1"
                               Grid.Column="0"
                               Grid.ColumnSpan="2"
                               Text="{Binding Data.RevenueTodayFormatted}"
                               Style="{StaticResource HeadlineLarge}"
                               Foreground="{ThemeResource OnSurfaceBrush}"
                               Margin="0,8,0,0" />
                    <StackPanel Grid.Row="2"
                                Grid.Column="0"
                                Grid.ColumnSpan="2"
                                Orientation="Horizontal"
                                Margin="0,8,0,0">
                      <FontIcon Glyph="&#xE74A;"
                                FontSize="12"
                                Foreground="{StaticResource PositiveChangeBrush}"
                                Margin="0,0,4,0" />
                      <TextBlock Text="{Binding Data.RevenueChangeFormatted}"
                                 Style="{StaticResource LabelMedium}"
                                 Foreground="{StaticResource PositiveChangeBrush}" />
                      <TextBlock x:Uid="DashboardPage.KPI.VsLastWeek"
                                 Style="{StaticResource LabelMedium}"
                                 Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                 Margin="4,0,0,0" />
                    </StackPanel>
                    <TextBlock Grid.Row="3"
                               Grid.Column="0"
                               Grid.ColumnSpan="2"
                               Style="{StaticResource BodySmall}"
                               Foreground="{ThemeResource OnSurfaceVariantBrush}"
                               Margin="0,4,0,0">
                      <Run x:Uid="DashboardPage.KPI.ThisWeek" />
                      <Run Text="{Binding Data.RevenueThisWeekFormatted}" />
                    </TextBlock>
                  </Grid>
                </Border>
              </DataTemplate>
            </mvux:FeedView.ValueTemplate>
            <mvux:FeedView.ProgressTemplate>
              <DataTemplate>
                <Border Background="{ThemeResource SurfaceBrush}"
                        CornerRadius="12"
                        Padding="20"
                        MinHeight="140"
                        Translation="0,0,8">
                  <Border.Shadow>
                    <ThemeShadow />
                  </Border.Shadow>
                  <ProgressRing IsActive="True"
                                Width="32"
                                Height="32"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                </Border>
              </DataTemplate>
            </mvux:FeedView.ProgressTemplate>
            <mvux:FeedView.ErrorTemplate>
              <DataTemplate>
                <Border Background="{ThemeResource ErrorContainerBrush}"
                        CornerRadius="12"
                        Padding="12"
                        MinHeight="140"
                        Translation="0,0,8">
                  <Border.Shadow>
                    <ThemeShadow />
                  </Border.Shadow>
                  <StackPanel VerticalAlignment="Center">
                    <TextBlock Text="Error loading revenue"
                               Style="{StaticResource BodySmall}"
                               Foreground="{ThemeResource OnErrorContainerBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{Binding Error.Message}"
                               Style="{StaticResource BodySmall}"
                               Foreground="{ThemeResource OnErrorContainerBrush}"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               MaxLines="3"
                               Margin="0,4,0,0" />
                  </StackPanel>
                </Border>
              </DataTemplate>
            </mvux:FeedView.ErrorTemplate>
          </mvux:FeedView>

          <!-- Orders Card with FeedView -->
          <mvux:FeedView x:Name="OrdersCardContainer"
                         Grid.Row="0"
                         Grid.Column="1"
                         Margin="8,0,8,0"
                         Source="{Binding OrdersData}">
            <mvux:FeedView.ValueTemplate>
              <DataTemplate>
                <Border Background="{ThemeResource SurfaceBrush}"
                        CornerRadius="12"
                        Padding="20"
                        Translation="0,0,8">
                  <Border.Shadow>
                    <ThemeShadow />
                  </Border.Shadow>
                  <Grid>
                    <Grid.RowDefinitions>
                      <RowDefinition Height="Auto" />
                      <RowDefinition Height="Auto" />
                      <RowDefinition Height="Auto" />
                      <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="*" />
                      <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Border Grid.Row="0"
                            Grid.Column="1"
                            Background="{ThemeResource PrimaryContainerBrush}"
                            CornerRadius="20"
                            Width="40"
                            Height="40">
                      <FontIcon Glyph="&#xE7BF;"
                                FontSize="18"
                                Foreground="{ThemeResource OnPrimaryContainerBrush}"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                    </Border>

                    <TextBlock Grid.Row="0"
                               Grid.Column="0"
                               x:Uid="DashboardPage.KPI.Orders"
                               Style="{StaticResource LabelLarge}"
                               Foreground="{ThemeResource OnSurfaceVariantBrush}" />
                    <TextBlock Grid.Row="1"
                               Grid.Column="0"
                               Grid.ColumnSpan="2"
                               Text="{Binding Data.OrdersToday}"
                               Style="{StaticResource HeadlineLarge}"
                               Foreground="{ThemeResource OnSurfaceBrush}"
                               Margin="0,8,0,0" />
                    <StackPanel Grid.Row="2"
                                Grid.Column="0"
                                Grid.ColumnSpan="2"
                                Orientation="Horizontal"
                                Margin="0,8,0,0">
                      <FontIcon Glyph="&#xE74A;"
                                FontSize="12"
                                Foreground="{StaticResource PositiveChangeBrush}"
                                Margin="0,0,4,0" />
                      <TextBlock Text="{Binding Data.OrdersChangeFormatted}"
                                 Style="{StaticResource LabelMedium}"
                                 Foreground="{StaticResource PositiveChangeBrush}" />
                      <TextBlock x:Uid="DashboardPage.KPI.VsLastWeek"
                                 Style="{StaticResource LabelMedium}"
                                 Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                 Margin="4,0,0,0" />
                    </StackPanel>
                    <TextBlock Grid.Row="3"
                               Grid.Column="0"
                               Grid.ColumnSpan="2"
                               Style="{StaticResource BodySmall}"
                               Foreground="{ThemeResource OnSurfaceVariantBrush}"
                               Margin="0,4,0,0">
                      <Run Text="{Binding Data.OrdersPending}" />
                      <Run x:Uid="DashboardPage.KPI.Pending" />
                    </TextBlock>
                  </Grid>
                </Border>
              </DataTemplate>
            </mvux:FeedView.ValueTemplate>
            <mvux:FeedView.ProgressTemplate>
              <DataTemplate>
                <Border Background="{ThemeResource SurfaceBrush}"
                        CornerRadius="12"
                        Padding="20"
                        MinHeight="140"
                        Translation="0,0,8">
                  <Border.Shadow>
                    <ThemeShadow />
                  </Border.Shadow>
                  <ProgressRing IsActive="True"
                                Width="32"
                                Height="32"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                </Border>
              </DataTemplate>
            </mvux:FeedView.ProgressTemplate>
            <mvux:FeedView.ErrorTemplate>
              <DataTemplate>
                <Border Background="{ThemeResource ErrorContainerBrush}"
                        CornerRadius="12"
                        Padding="12"
                        MinHeight="140"
                        Translation="0,0,8">
                  <Border.Shadow>
                    <ThemeShadow />
                  </Border.Shadow>
                  <StackPanel VerticalAlignment="Center">
                    <TextBlock Text="Error loading orders"
                               Style="{StaticResource BodySmall}"
                               Foreground="{ThemeResource OnErrorContainerBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{Binding Error.Message}"
                               Style="{StaticResource BodySmall}"
                               Foreground="{ThemeResource OnErrorContainerBrush}"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               MaxLines="3"
                               Margin="0,4,0,0" />
                  </StackPanel>
                </Border>
              </DataTemplate>
            </mvux:FeedView.ErrorTemplate>
          </mvux:FeedView>

          <!-- Customers Card with FeedView -->
          <mvux:FeedView x:Name="CustomersCardContainer"
                         Grid.Row="0"
                         Grid.Column="2"
                         Margin="8,0,8,0"
                         Source="{Binding CustomersData}">
            <mvux:FeedView.ValueTemplate>
              <DataTemplate>
                <Border Background="{ThemeResource SurfaceBrush}"
                        CornerRadius="12"
                        Padding="20"
                        Translation="0,0,8">
                  <Border.Shadow>
                    <ThemeShadow />
                  </Border.Shadow>
                  <Grid>
                    <Grid.RowDefinitions>
                      <RowDefinition Height="Auto" />
                      <RowDefinition Height="Auto" />
                      <RowDefinition Height="Auto" />
                      <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="*" />
                      <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Border Grid.Row="0"
                            Grid.Column="1"
                            Background="{ThemeResource SecondaryContainerBrush}"
                            CornerRadius="20"
                            Width="40"
                            Height="40">
                      <FontIcon Glyph="&#xE716;"
                                FontSize="18"
                                Foreground="{ThemeResource OnSecondaryContainerBrush}"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                    </Border>

                    <TextBlock Grid.Row="0"
                               Grid.Column="0"
                               x:Uid="DashboardPage.KPI.Customers"
                               Style="{StaticResource LabelLarge}"
                               Foreground="{ThemeResource OnSurfaceVariantBrush}" />
                    <TextBlock Grid.Row="1"
                               Grid.Column="0"
                               Grid.ColumnSpan="2"
                               Text="{Binding Data.CustomersTotal}"
                               Style="{StaticResource HeadlineLarge}"
                               Foreground="{ThemeResource OnSurfaceBrush}"
                               Margin="0,8,0,0" />
                    <StackPanel Grid.Row="2"
                                Grid.Column="0"
                                Grid.ColumnSpan="2"
                                Orientation="Horizontal"
                                Margin="0,8,0,0">
                      <FontIcon Glyph="&#xE74A;"
                                FontSize="12"
                                Foreground="{StaticResource PositiveChangeBrush}"
                                Margin="0,0,4,0" />
                      <TextBlock Text="{Binding Data.CustomersChangeFormatted}"
                                 Style="{StaticResource LabelMedium}"
                                 Foreground="{StaticResource PositiveChangeBrush}" />
                      <TextBlock x:Uid="DashboardPage.KPI.VsLastMonth"
                                 Style="{StaticResource LabelMedium}"
                                 Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                 Margin="4,0,0,0" />
                    </StackPanel>
                    <TextBlock Grid.Row="3"
                               Grid.Column="0"
                               Grid.ColumnSpan="2"
                               Style="{StaticResource BodySmall}"
                               Foreground="{ThemeResource OnSurfaceVariantBrush}"
                               Margin="0,4,0,0">
                      <Run Text="{Binding Data.CustomersNewThisMonth}" />
                      <Run x:Uid="DashboardPage.KPI.NewThisMonth" />
                    </TextBlock>
                  </Grid>
                </Border>
              </DataTemplate>
            </mvux:FeedView.ValueTemplate>
            <mvux:FeedView.ProgressTemplate>
              <DataTemplate>
                <Border Background="{ThemeResource SurfaceBrush}"
                        CornerRadius="12"
                        Padding="20"
                        MinHeight="140"
                        Translation="0,0,8">
                  <Border.Shadow>
                    <ThemeShadow />
                  </Border.Shadow>
                  <ProgressRing IsActive="True"
                                Width="32"
                                Height="32"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                </Border>
              </DataTemplate>
            </mvux:FeedView.ProgressTemplate>
            <mvux:FeedView.ErrorTemplate>
              <DataTemplate>
                <Border Background="{ThemeResource ErrorContainerBrush}"
                        CornerRadius="12"
                        Padding="12"
                        MinHeight="140"
                        Translation="0,0,8">
                  <Border.Shadow>
                    <ThemeShadow />
                  </Border.Shadow>
                  <StackPanel VerticalAlignment="Center">
                    <TextBlock Text="Error loading customers"
                               Style="{StaticResource BodySmall}"
                               Foreground="{ThemeResource OnErrorContainerBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{Binding Error.Message}"
                               Style="{StaticResource BodySmall}"
                               Foreground="{ThemeResource OnErrorContainerBrush}"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               MaxLines="3"
                               Margin="0,4,0,0" />
                  </StackPanel>
                </Border>
              </DataTemplate>
            </mvux:FeedView.ErrorTemplate>
          </mvux:FeedView>

          <!-- Inventory Card with FeedView -->
          <mvux:FeedView x:Name="InventoryCardContainer"
                         Grid.Row="0"
                         Grid.Column="3"
                         Margin="8,0,0,0"
                         Source="{Binding ProductsData}">
            <mvux:FeedView.ValueTemplate>
              <DataTemplate>
                <Border Background="{ThemeResource SurfaceBrush}"
                        CornerRadius="12"
                        Padding="20"
                        Translation="0,0,8">
                  <Border.Shadow>
                    <ThemeShadow />
                  </Border.Shadow>
                  <Grid>
                    <Grid.RowDefinitions>
                      <RowDefinition Height="Auto" />
                      <RowDefinition Height="Auto" />
                      <RowDefinition Height="Auto" />
                      <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="*" />
                      <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Border Grid.Row="0"
                            Grid.Column="1"
                            Background="{ThemeResource ErrorContainerBrush}"
                            CornerRadius="20"
                            Width="40"
                            Height="40">
                      <FontIcon Glyph="&#xE8F1;"
                                FontSize="18"
                                Foreground="{ThemeResource OnErrorContainerBrush}"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                    </Border>

                    <TextBlock Grid.Row="0"
                               Grid.Column="0"
                               x:Uid="DashboardPage.KPI.Inventory"
                               Style="{StaticResource LabelLarge}"
                               Foreground="{ThemeResource OnSurfaceVariantBrush}" />
                    <TextBlock Grid.Row="1"
                               Grid.Column="0"
                               Grid.ColumnSpan="2"
                               Text="{Binding Data.StockRatio}"
                               Style="{StaticResource HeadlineLarge}"
                               Foreground="{ThemeResource OnSurfaceBrush}"
                               Margin="0,8,0,0" />
                    <StackPanel Grid.Row="2"
                                Grid.Column="0"
                                Grid.ColumnSpan="2"
                                Orientation="Horizontal"
                                Margin="0,8,0,0">
                      <FontIcon Glyph="&#xE74B;"
                                FontSize="12"
                                Foreground="{StaticResource NegativeChangeBrush}"
                                Margin="0,0,4,0" />
                      <TextBlock Text="{Binding Data.ProductsChangeFormatted}"
                                 Style="{StaticResource LabelMedium}"
                                 Foreground="{StaticResource NegativeChangeBrush}" />
                      <TextBlock x:Uid="DashboardPage.KPI.VsLastWeek"
                                 Style="{StaticResource LabelMedium}"
                                 Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                 Margin="4,0,0,0" />
                    </StackPanel>
                    <TextBlock Grid.Row="3"
                               Grid.Column="0"
                               Grid.ColumnSpan="2"
                               Style="{StaticResource BodySmall}"
                               Foreground="{StaticResource WarningAlertBrush}"
                               Margin="0,4,0,0">
                      <Run Text="{Binding Data.ProductsLowStock}" />
                      <Run x:Uid="DashboardPage.KPI.LowStockItems" />
                    </TextBlock>
                  </Grid>
                </Border>
              </DataTemplate>
            </mvux:FeedView.ValueTemplate>
            <mvux:FeedView.ProgressTemplate>
              <DataTemplate>
                <Border Background="{ThemeResource SurfaceBrush}"
                        CornerRadius="12"
                        Padding="20"
                        MinHeight="140"
                        Translation="0,0,8">
                  <Border.Shadow>
                    <ThemeShadow />
                  </Border.Shadow>
                  <ProgressRing IsActive="True"
                                Width="32"
                                Height="32"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                </Border>
              </DataTemplate>
            </mvux:FeedView.ProgressTemplate>
            <mvux:FeedView.ErrorTemplate>
              <DataTemplate>
                <Border Background="{ThemeResource ErrorContainerBrush}"
                        CornerRadius="12"
                        Padding="12"
                        MinHeight="140"
                        Translation="0,0,8">
                  <Border.Shadow>
                    <ThemeShadow />
                  </Border.Shadow>
                  <StackPanel VerticalAlignment="Center">
                    <TextBlock Text="Error loading inventory"
                               Style="{StaticResource BodySmall}"
                               Foreground="{ThemeResource OnErrorContainerBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="{Binding Error.Message}"
                               Style="{StaticResource BodySmall}"
                               Foreground="{ThemeResource OnErrorContainerBrush}"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               MaxLines="3"
                               Margin="0,4,0,0" />
                  </StackPanel>
                </Border>
              </DataTemplate>
            </mvux:FeedView.ErrorTemplate>
          </mvux:FeedView>
        </Grid>

        <!-- Activity Section Header -->
        <TextBlock x:Uid="DashboardPage.Section.Activity"
                   Style="{StaticResource TitleMedium}"
                   Foreground="{ThemeResource OnSurfaceBrush}" />

        <!-- Activity Cards Row -->
        <Grid x:Name="ActivityGrid">
          <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="ActivityColumn1" Width="*" />
            <ColumnDefinition x:Name="ActivityColumn2" Width="*" />
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>

          <!-- Recent Orders Card -->
          <Border x:Name="RecentOrdersCard"
                  Grid.Column="0"
                  Grid.Row="0"
                  Margin="0,0,8,0"
                  Background="{ThemeResource SurfaceBrush}"
                  CornerRadius="12"
                  MinHeight="300"
                  Translation="0,0,8">
            <Border.Shadow>
              <ThemeShadow />
            </Border.Shadow>
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
              </Grid.RowDefinitions>

              <!-- Card Header -->
              <Grid Grid.Row="0"
                    Padding="16,16,16,8">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0"
                            Orientation="Horizontal">
                  <FontIcon Glyph="&#xE7BF;"
                            FontSize="20"
                            Foreground="{ThemeResource PrimaryBrush}"
                            Margin="0,0,12,0" />
                  <TextBlock x:Uid="DashboardPage.Card.RecentOrders"
                             Style="{StaticResource TitleMedium}"
                             Foreground="{ThemeResource OnSurfaceBrush}" />
                </StackPanel>
                <Button Grid.Column="1"
                        x:Uid="DashboardPage.Button.ViewAll"
                        Command="{Binding NavigateToOrderList}"
                        Style="{StaticResource TextButtonStyle}" />
              </Grid>

              <!-- Orders List -->
              <mvux:FeedView Grid.Row="1"
                             Source="{Binding RecentOrders}"
                             Padding="0,0,0,8">
                <mvux:FeedView.ValueTemplate>
                  <DataTemplate>
                    <ItemsRepeater ItemsSource="{Binding Data}">
                      <ItemsRepeater.ItemTemplate>
                        <DataTemplate>
                          <Button Click="OrderRow_Click"
                                  HorizontalAlignment="Stretch"
                                  HorizontalContentAlignment="Stretch"
                                  Background="Transparent"
                                  BorderThickness="0"
                                  Padding="0">
                            <Grid Padding="16,10"
                                  Background="Transparent">
                              <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                              </Grid.ColumnDefinitions>
                              <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                              </Grid.RowDefinitions>

                              <FontIcon Grid.Row="0"
                                        Grid.RowSpan="2"
                                        Grid.Column="0"
                                        Glyph="{Binding StatusIcon}"
                                        FontSize="16"
                                        Foreground="{ThemeResource PrimaryBrush}"
                                        VerticalAlignment="Center"
                                        Margin="0,0,12,0" />

                              <TextBlock Grid.Row="0"
                                         Grid.Column="1"
                                         Text="{Binding OrderNumber}"
                                         Style="{StaticResource BodyMedium}"
                                         Foreground="{ThemeResource OnSurfaceBrush}" />
                              <TextBlock Grid.Row="1"
                                         Grid.Column="1"
                                         Text="{Binding CustomerName}"
                                         Style="{StaticResource BodySmall}"
                                         Foreground="{ThemeResource OnSurfaceVariantBrush}" />

                              <TextBlock Grid.Row="0"
                                         Grid.Column="2"
                                         Text="{Binding AmountFormatted}"
                                         Style="{StaticResource BodyMedium}"
                                         Foreground="{ThemeResource OnSurfaceBrush}"
                                         HorizontalAlignment="Right" />
                              <TextBlock Grid.Row="1"
                                         Grid.Column="2"
                                         Text="{Binding DateFormatted}"
                                         Style="{StaticResource BodySmall}"
                                         Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                         HorizontalAlignment="Right" />
                            </Grid>
                          </Button>
                        </DataTemplate>
                      </ItemsRepeater.ItemTemplate>
                    </ItemsRepeater>
                  </DataTemplate>
                </mvux:FeedView.ValueTemplate>

                <mvux:FeedView.ProgressTemplate>
                  <DataTemplate>
                    <ProgressRing IsActive="True"
                                  Width="32"
                                  Height="32"
                                  Margin="16"
                                  HorizontalAlignment="Center" />
                  </DataTemplate>
                </mvux:FeedView.ProgressTemplate>
              </mvux:FeedView>
            </Grid>
          </Border>

          <!-- Top Products Card -->
          <Border x:Name="TopProductsCard"
                  Grid.Column="1"
                  Grid.Row="0"
                  Margin="8,0,0,0"
                  Background="{ThemeResource SurfaceBrush}"
                  CornerRadius="12"
                  MinHeight="300"
                  Translation="0,0,8">
            <Border.Shadow>
              <ThemeShadow />
            </Border.Shadow>
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
              </Grid.RowDefinitions>

              <!-- Card Header -->
              <Grid Grid.Row="0"
                    Padding="16,16,16,8">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0"
                            Orientation="Horizontal">
                  <FontIcon Glyph="&#xE735;"
                            FontSize="20"
                            Foreground="{ThemeResource TertiaryBrush}"
                            Margin="0,0,12,0" />
                  <TextBlock x:Uid="DashboardPage.Card.TopProducts"
                             Style="{StaticResource TitleMedium}"
                             Foreground="{ThemeResource OnSurfaceBrush}" />
                </StackPanel>
                <Button Grid.Column="1"
                        x:Uid="DashboardPage.Button.ViewAll"
                        Command="{Binding NavigateToProductList}"
                        Style="{StaticResource TextButtonStyle}" />
              </Grid>

              <!-- Products List -->
              <mvux:FeedView Grid.Row="1"
                             Source="{Binding TopProducts}"
                             Padding="0,0,0,8">
                <mvux:FeedView.ValueTemplate>
                  <DataTemplate>
                    <ItemsRepeater ItemsSource="{Binding Data}">
                      <ItemsRepeater.ItemTemplate>
                        <DataTemplate>
                          <Grid Padding="16,10"
                                Background="Transparent">
                            <Grid.ColumnDefinitions>
                              <ColumnDefinition Width="Auto" />
                              <ColumnDefinition Width="*" />
                              <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                              <RowDefinition Height="Auto" />
                              <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0"
                                    Grid.RowSpan="2"
                                    Grid.Column="0"
                                    Background="{ThemeResource TertiaryContainerBrush}"
                                    CornerRadius="4"
                                    Padding="8,4"
                                    VerticalAlignment="Center"
                                    Margin="0,0,12,0">
                              <TextBlock Text="{Binding RankFormatted}"
                                         Style="{StaticResource LabelMedium}"
                                         Foreground="{ThemeResource OnTertiaryContainerBrush}" />
                            </Border>

                            <TextBlock Grid.Row="0"
                                       Grid.Column="1"
                                       Text="{Binding ProductName}"
                                       Style="{StaticResource BodyMedium}"
                                       Foreground="{ThemeResource OnSurfaceBrush}"
                                       TextTrimming="CharacterEllipsis"
                                       MaxLines="1" />
                            <TextBlock Grid.Row="1"
                                       Grid.Column="1"
                                       Text="{Binding Sku}"
                                       Style="{StaticResource BodySmall}"
                                       Foreground="{ThemeResource OnSurfaceVariantBrush}" />

                            <TextBlock Grid.Row="0"
                                       Grid.Column="2"
                                       Text="{Binding RevenueFormatted}"
                                       Style="{StaticResource BodyMedium}"
                                       Foreground="{ThemeResource OnSurfaceBrush}"
                                       HorizontalAlignment="Right" />
                            <TextBlock Grid.Row="1"
                                       Grid.Column="2"
                                       Style="{StaticResource BodySmall}"
                                       Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                       HorizontalAlignment="Right">
                              <Run Text="{Binding QuantitySold}" />
                              <Run x:Uid="DashboardPage.Label.Sold" />
                            </TextBlock>
                          </Grid>
                        </DataTemplate>
                      </ItemsRepeater.ItemTemplate>
                    </ItemsRepeater>
                  </DataTemplate>
                </mvux:FeedView.ValueTemplate>

                <mvux:FeedView.ProgressTemplate>
                  <DataTemplate>
                    <ProgressRing IsActive="True"
                                  Width="32"
                                  Height="32"
                                  Margin="16"
                                  HorizontalAlignment="Center" />
                  </DataTemplate>
                </mvux:FeedView.ProgressTemplate>
              </mvux:FeedView>
            </Grid>
          </Border>
        </Grid>
      </StackPanel>
    </Grid>
  </ScrollViewer>
</Page>
