<Page x:Class="maERP.Client.Features.Customers.Views.CustomerListPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:maERP.Client.Features.Customers.Views"
      xmlns:models="using:maERP.Client.Features.Customers.Models"
      xmlns:mvux="using:Uno.Extensions.Reactive.UI"
      xmlns:utu="using:Uno.Toolkit.UI"
      xmlns:uen="using:Uno.Extensions.Navigation.UI"
      Background="{ThemeResource BackgroundBrush}">

  <Grid utu:SafeArea.Insets="VisibleBounds">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!-- Header -->
    <utu:NavigationBar Grid.Row="0" Content="Customers">
      <utu:NavigationBar.MainCommand>
        <AppBarButton Icon="Add"
                      Label="New"
                      Command="{Binding CreateCustomer}" />
      </utu:NavigationBar.MainCommand>
    </utu:NavigationBar>

    <!-- Search Box -->
    <TextBox Grid.Row="1"
             Margin="16,8"
             PlaceholderText="Search customers..."
             Text="{Binding SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

    <!-- Customer List -->
    <mvux:FeedView Grid.Row="2"
                   Source="{Binding Customers}">
      <mvux:FeedView.ValueTemplate>
        <DataTemplate>
          <ListView ItemsSource="{Binding Data}"
                    SelectionMode="None">
            <ListView.ItemTemplate>
              <DataTemplate>
                <Grid Padding="16,12"
                      Background="Transparent"
                      utu:CommandExtensions.Command="{Binding DataContext.ViewCustomer, RelativeSource={RelativeSource Mode=TemplatedParent}}"
                      utu:CommandExtensions.CommandParameter="{Binding}">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                  </Grid.ColumnDefinitions>

                  <!-- Avatar -->
                  <PersonPicture Grid.Column="0"
                                 Width="48"
                                 Height="48"
                                 DisplayName="{Binding Firstname}" />

                  <!-- Name and Email -->
                  <StackPanel Grid.Column="1"
                              Margin="16,0,0,0"
                              VerticalAlignment="Center">
                    <TextBlock Style="{StaticResource BodyStrongTextBlockStyle}">
                      <Run Text="{Binding Firstname}" />
                      <Run Text=" " />
                      <Run Text="{Binding Lastname}" />
                    </TextBlock>
                    <TextBlock Text="{Binding Email}"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                  </StackPanel>

                  <!-- Chevron -->
                  <FontIcon Grid.Column="2"
                            Glyph="&#xE76C;"
                            FontSize="12"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                </Grid>
              </DataTemplate>
            </ListView.ItemTemplate>
          </ListView>
        </DataTemplate>
      </mvux:FeedView.ValueTemplate>

      <mvux:FeedView.ProgressTemplate>
        <DataTemplate>
          <ProgressRing IsActive="True"
                        Width="48"
                        Height="48"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center" />
        </DataTemplate>
      </mvux:FeedView.ProgressTemplate>

      <mvux:FeedView.NoneTemplate>
        <DataTemplate>
          <StackPanel HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Spacing="16">
            <FontIcon Glyph="&#xE716;"
                      FontSize="48"
                      Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
            <TextBlock Text="No customers found"
                       Style="{StaticResource BodyTextBlockStyle}"
                       HorizontalAlignment="Center" />
          </StackPanel>
        </DataTemplate>
      </mvux:FeedView.NoneTemplate>

      <mvux:FeedView.ErrorTemplate>
        <DataTemplate>
          <StackPanel HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Spacing="16">
            <FontIcon Glyph="&#xE783;"
                      FontSize="48"
                      Foreground="{ThemeResource SystemFillColorCriticalBrush}" />
            <TextBlock Text="Failed to load customers"
                       Style="{StaticResource BodyTextBlockStyle}"
                       HorizontalAlignment="Center" />
          </StackPanel>
        </DataTemplate>
      </mvux:FeedView.ErrorTemplate>
    </mvux:FeedView>
  </Grid>
</Page>
