<Page x:Class="maERP.Client.Features.Customers.Views.CustomerListPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:maERP.Client.Features.Customers.Views"
      xmlns:models="using:maERP.Client.Features.Customers.Models"
      xmlns:mvux="using:Uno.Extensions.Reactive.UI"
      xmlns:utu="using:Uno.Toolkit.UI"
      xmlns:uen="using:Uno.Extensions.Navigation.UI"
      xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
      Background="{ThemeResource BackgroundBrush}">

  <Grid utu:SafeArea.Insets="VisibleBounds">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!-- Header with NavigationBar -->
    <utu:NavigationBar Grid.Row="0"
                       x:Uid="CustomerListPage.NavigationBar">
      <utu:NavigationBar.PrimaryCommands>
        <AppBarButton x:Uid="CustomerListPage.AppBarButton.Refresh"
                      Command="{Binding Refresh, ElementName=CustomersFeedView}">
          <AppBarButton.Icon>
            <FontIcon Glyph="&#xE72C;" />
          </AppBarButton.Icon>
        </AppBarButton>
        <AppBarButton x:Uid="CustomerListPage.AppBarButton.New"
                      Click="CreateCustomer_Click">
          <AppBarButton.Icon>
            <FontIcon Glyph="&#xE710;" />
          </AppBarButton.Icon>
        </AppBarButton>
      </utu:NavigationBar.PrimaryCommands>
    </utu:NavigationBar>

    <!-- Search Box -->
    <Grid Grid.Row="1"
          Margin="16,12,16,8">
      <TextBox x:Name="SearchBox"
               x:Uid="CustomerListPage.SearchBox"
               TextChanged="SearchBox_TextChanged"
               Padding="40,0,12,0" />
      <FontIcon Glyph="&#xE721;"
                FontSize="16"
                Foreground="{ThemeResource OnSurfaceVariantBrush}"
                HorizontalAlignment="Left"
                VerticalAlignment="Center"
                Margin="12,0,0,0"
                IsHitTestVisible="False" />
    </Grid>

    <!-- Customer DataGrid -->
    <mvux:FeedView x:Name="CustomersFeedView"
                   Grid.Row="2"
                   Margin="16,0"
                   Source="{Binding Customers}">
      <mvux:FeedView.ValueTemplate>
        <DataTemplate>
          <controls:DataGrid x:Name="CustomerDataGrid"
                             ItemsSource="{Binding Data}"
                             AutoGenerateColumns="False"
                             IsReadOnly="True"
                             SelectionMode="Single"
                             GridLinesVisibility="Horizontal"
                             HeadersVisibility="Column"
                             CanUserReorderColumns="True"
                             CanUserResizeColumns="True"
                             CanUserSortColumns="True"
                             SelectionChanged="CustomerDataGrid_SelectionChanged"
                             Sorting="CustomerDataGrid_Sorting">
            <controls:DataGrid.Columns>
              <controls:DataGridTextColumn x:Uid="CustomerListPage.DataGrid.CustomerId"
                                           Binding="{Binding CustomerId}"
                                           Tag="CustomerId"
                                           Width="100" />
              <controls:DataGridTextColumn x:Uid="CustomerListPage.DataGrid.FirstName"
                                           Binding="{Binding Firstname}"
                                           Tag="Firstname"
                                           Width="*" />
              <controls:DataGridTextColumn x:Uid="CustomerListPage.DataGrid.LastName"
                                           Binding="{Binding Lastname}"
                                           Tag="Lastname"
                                           Width="*" />
              <controls:DataGridTextColumn x:Uid="CustomerListPage.DataGrid.EnrollmentDate"
                                           Binding="{Binding DateEnrollment, Converter={StaticResource DateOnlyConverter}}"
                                           Tag="DateEnrollment"
                                           Width="150" />
            </controls:DataGrid.Columns>
          </controls:DataGrid>
        </DataTemplate>
      </mvux:FeedView.ValueTemplate>

      <mvux:FeedView.ProgressTemplate>
        <DataTemplate>
          <ProgressRing IsActive="True"
                        Width="48"
                        Height="48"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center" />
        </DataTemplate>
      </mvux:FeedView.ProgressTemplate>

      <mvux:FeedView.NoneTemplate>
        <DataTemplate>
          <StackPanel HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Spacing="16">
            <FontIcon Glyph="&#xE716;"
                      FontSize="48"
                      Foreground="{ThemeResource OnSurfaceVariantBrush}" />
            <TextBlock x:Uid="CustomerListPage.NoCustomers"
                       Style="{StaticResource BodyMedium}"
                       HorizontalAlignment="Center" />
          </StackPanel>
        </DataTemplate>
      </mvux:FeedView.NoneTemplate>

      <mvux:FeedView.ErrorTemplate>
        <DataTemplate>
          <StackPanel HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Spacing="16">
            <FontIcon Glyph="&#xE783;"
                      FontSize="48"
                      Foreground="{ThemeResource ErrorBrush}" />
            <TextBlock x:Uid="CustomerListPage.LoadError"
                       Style="{StaticResource BodyMedium}"
                       HorizontalAlignment="Center" />
          </StackPanel>
        </DataTemplate>
      </mvux:FeedView.ErrorTemplate>
    </mvux:FeedView>

    <!-- Pagination Controls -->
    <Border Grid.Row="3"
            Background="{ThemeResource SurfaceBrush}"
            BorderBrush="{ThemeResource OutlineVariantBrush}"
            BorderThickness="0,1,0,0"
            Padding="16,8">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- Count Info (Left) -->
        <mvux:FeedView Source="{Binding Pagination}"
                       Grid.Column="0">
          <mvux:FeedView.ValueTemplate>
            <DataTemplate>
              <TextBlock Text="{Binding Data.CountInfo}"
                         Style="{StaticResource BodySmall}"
                         Foreground="{ThemeResource OnSurfaceVariantBrush}"
                         VerticalAlignment="Center" />
            </DataTemplate>
          </mvux:FeedView.ValueTemplate>
        </mvux:FeedView>

        <!-- Page Navigation (Center) -->
        <StackPanel Grid.Column="1"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Spacing="8">
          <Button x:Name="PreviousPageButton"
                  Style="{StaticResource IconButtonStyle}"
                  x:Uid="CustomerListPage.PreviousPage"
                  Click="PreviousPage_Click">
            <FontIcon Glyph="&#xE76B;"
                      FontSize="16" />
          </Button>

          <mvux:FeedView Source="{Binding Pagination}">
            <mvux:FeedView.ValueTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Data.PageInfo}"
                           Style="{StaticResource BodyMedium}"
                           VerticalAlignment="Center"
                           MinWidth="100"
                           TextAlignment="Center" />
              </DataTemplate>
            </mvux:FeedView.ValueTemplate>
          </mvux:FeedView>

          <Button x:Name="NextPageButton"
                  Style="{StaticResource IconButtonStyle}"
                  x:Uid="CustomerListPage.NextPage"
                  Click="NextPage_Click">
            <FontIcon Glyph="&#xE76C;"
                      FontSize="16" />
          </Button>
        </StackPanel>

        <!-- Page Size Selection (Right) -->
        <StackPanel Grid.Column="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Spacing="8">
          <TextBlock x:Uid="CustomerListPage.ItemsPerPage"
                     Style="{StaticResource BodySmall}"
                     Foreground="{ThemeResource OnSurfaceVariantBrush}"
                     VerticalAlignment="Center" />
          <ComboBox x:Name="PageSizeComboBox"
                    MinWidth="80"
                    SelectionChanged="PageSizeComboBox_SelectionChanged"
                    SelectedIndex="1">
            <ComboBoxItem Content="10" Tag="10" />
            <ComboBoxItem Content="25" Tag="25" />
            <ComboBoxItem Content="100" Tag="100" />
            <ComboBoxItem Content="500" Tag="500" />
            <ComboBoxItem Content="1000" Tag="1000" />
          </ComboBox>
        </StackPanel>
      </Grid>
    </Border>
  </Grid>
</Page>
