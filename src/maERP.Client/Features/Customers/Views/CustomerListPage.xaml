<Page x:Class="maERP.Client.Features.Customers.Views.CustomerListPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:maERP.Client.Features.Customers.Views"
      xmlns:models="using:maERP.Client.Features.Customers.Models"
      xmlns:mvux="using:Uno.Extensions.Reactive.UI"
      xmlns:utu="using:Uno.Toolkit.UI"
      xmlns:uen="using:Uno.Extensions.Navigation.UI"
      xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
      Background="{ThemeResource BackgroundBrush}">

  <Grid utu:SafeArea.Insets="VisibleBounds">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!-- Header -->
    <utu:NavigationBar Grid.Row="0" Content="Customers">
      <utu:NavigationBar.MainCommand>
        <AppBarButton Icon="Add"
                      Label="New"
                      Command="{Binding CreateCustomer}" />
      </utu:NavigationBar.MainCommand>
    </utu:NavigationBar>

    <!-- Search Box -->
    <TextBox Grid.Row="1"
             Margin="16,8"
             PlaceholderText="Search customers..."
             Text="{Binding SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

    <!-- Customer DataGrid -->
    <mvux:FeedView Grid.Row="2"
                   Source="{Binding Customers}">
      <mvux:FeedView.ValueTemplate>
        <DataTemplate>
          <controls:DataGrid x:Name="CustomerDataGrid"
                             ItemsSource="{Binding Data}"
                             AutoGenerateColumns="False"
                             IsReadOnly="True"
                             SelectionMode="Single"
                             GridLinesVisibility="Horizontal"
                             HeadersVisibility="Column"
                             CanUserReorderColumns="True"
                             CanUserResizeColumns="True"
                             CanUserSortColumns="True"
                             SelectionChanged="CustomerDataGrid_SelectionChanged">
            <controls:DataGrid.Columns>
              <controls:DataGridTextColumn Header="Customer #"
                                           Binding="{Binding CustomerId}"
                                           Width="100" />
              <controls:DataGridTextColumn Header="First Name"
                                           Binding="{Binding Firstname}"
                                           Width="*" />
              <controls:DataGridTextColumn Header="Last Name"
                                           Binding="{Binding Lastname}"
                                           Width="*" />
              <controls:DataGridTextColumn Header="Enrollment Date"
                                           Binding="{Binding DateEnrollment}"
                                           Width="150" />
            </controls:DataGrid.Columns>
          </controls:DataGrid>
        </DataTemplate>
      </mvux:FeedView.ValueTemplate>

      <mvux:FeedView.ProgressTemplate>
        <DataTemplate>
          <ProgressRing IsActive="True"
                        Width="48"
                        Height="48"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center" />
        </DataTemplate>
      </mvux:FeedView.ProgressTemplate>

      <mvux:FeedView.NoneTemplate>
        <DataTemplate>
          <StackPanel HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Spacing="16">
            <FontIcon Glyph="&#xE716;"
                      FontSize="48"
                      Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
            <TextBlock Text="No customers found"
                       Style="{StaticResource BodyTextBlockStyle}"
                       HorizontalAlignment="Center" />
          </StackPanel>
        </DataTemplate>
      </mvux:FeedView.NoneTemplate>

      <mvux:FeedView.ErrorTemplate>
        <DataTemplate>
          <StackPanel HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      Spacing="16">
            <FontIcon Glyph="&#xE783;"
                      FontSize="48"
                      Foreground="{ThemeResource SystemFillColorCriticalBrush}" />
            <TextBlock Text="Failed to load customers"
                       Style="{StaticResource BodyTextBlockStyle}"
                       HorizontalAlignment="Center" />
          </StackPanel>
        </DataTemplate>
      </mvux:FeedView.ErrorTemplate>
    </mvux:FeedView>
  </Grid>
</Page>
