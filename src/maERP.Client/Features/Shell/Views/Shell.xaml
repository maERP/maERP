<UserControl x:Class="maERP.Client.Features.Shell.Views.Shell"
     xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
     xmlns:local="using:maERP.Client.Features.Shell.Views"
     xmlns:models="using:maERP.Client.Features.Shell.Models"
     xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
     xmlns:utu="using:Uno.Toolkit.UI"
     xmlns:uen="using:Uno.Extensions.Navigation.UI"
     mc:Ignorable="d"
     d:DesignHeight="800"
     d:DesignWidth="1280">

  <UserControl.Resources>
  </UserControl.Resources>

  <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <!-- VisualStateManager for responsive breakpoints -->
    <VisualStateManager.VisualStateGroups>
      <VisualStateGroup>
        <!-- Narrow: Mobile phones (< 700px) -->
        <VisualState x:Name="Narrow">
          <VisualState.Setters>
            <Setter Target="TabBarNav.Visibility" Value="Visible" />
            <Setter Target="NavView.PaneDisplayMode" Value="LeftMinimal" />
            <Setter Target="NavView.IsPaneOpen" Value="False" />
            <Setter Target="NavView.IsPaneVisible" Value="False" />
            <Setter Target="AppHeader.Visibility" Value="Collapsed" />
          </VisualState.Setters>
        </VisualState>

        <!-- Normal: Tablets (700px - 999px) -->
        <VisualState x:Name="Normal">
          <VisualState.StateTriggers>
            <AdaptiveTrigger MinWindowWidth="700" />
          </VisualState.StateTriggers>
          <VisualState.Setters>
            <Setter Target="TabBarNav.Visibility" Value="Collapsed" />
            <Setter Target="PaneToggleButton.Visibility" Value="Visible" />
            <Setter Target="NavView.IsPaneVisible" Value="True" />
            <Setter Target="NavView.PaneDisplayMode" Value="Left" />
            <Setter Target="AppHeader.Visibility" Value="Visible" />
          </VisualState.Setters>
        </VisualState>

        <!-- Wide: Desktop (>= 1000px) -->
        <VisualState x:Name="Wide">
          <VisualState.StateTriggers>
            <AdaptiveTrigger MinWindowWidth="1000" />
          </VisualState.StateTriggers>
          <VisualState.Setters>
            <Setter Target="TabBarNav.Visibility" Value="Collapsed" />
            <Setter Target="PaneToggleButton.Visibility" Value="Visible" />
            <Setter Target="NavView.IsPaneVisible" Value="True" />
            <Setter Target="NavView.PaneDisplayMode" Value="Left" />
            <Setter Target="NavView.IsPaneOpen" Value="True" />
            <Setter Target="AppHeader.Visibility" Value="Visible" />
          </VisualState.Setters>
        </VisualState>
      </VisualStateGroup>
    </VisualStateManager.VisualStateGroups>

    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!-- App Header with Logo and User Menu -->
    <Grid x:Name="AppHeader"
          Grid.Row="0"
          Height="48"
          Background="{ThemeResource SurfaceVariantBrush}"
          BorderBrush="{ThemeResource OutlineVariantBrush}"
          BorderThickness="0,0,0,1">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <!-- Hamburger Menu Button -->
      <Button x:Name="PaneToggleButton"
              Grid.Column="0"
              Width="48"
              Height="48"
              Background="Transparent"
              BorderThickness="0"
              Click="OnPaneToggleClick"
              VerticalAlignment="Center">
        <FontIcon Glyph="&#xE700;"
                  FontSize="16" />
      </Button>

      <!-- Logo and Tenant Switcher (centered) -->
      <StackPanel Grid.Column="1"
                  Orientation="Horizontal"
                  HorizontalAlignment="Center"
                  VerticalAlignment="Center">
        <Image Source="ms-appx:///Assets/Icons/icon.svg"
               Width="28"
               Height="28"
               Stretch="Uniform"
               VerticalAlignment="Center" />

        <!-- Multiple Tenants: Show Dropdown Button -->
        <DropDownButton x:Name="TenantSwitcher"
                        Margin="12,0,0,0"
                        Visibility="Collapsed"
                        Background="Transparent"
                        BorderThickness="0">
          <TextBlock x:Name="TenantSwitcherText"
                     Style="{StaticResource TitleTextBlockStyle}"
                     VerticalAlignment="Center" />
          <DropDownButton.Flyout>
            <MenuFlyout x:Name="TenantMenuFlyout"
                        Placement="BottomEdgeAlignedLeft" />
          </DropDownButton.Flyout>
        </DropDownButton>

        <!-- Single Tenant or No Tenant: Show Text -->
        <TextBlock x:Name="TenantName"
                   Style="{StaticResource TitleTextBlockStyle}"
                   VerticalAlignment="Center"
                   Margin="12,0,0,0"
                   Visibility="Visible" />
      </StackPanel>

      <!-- User Menu -->
      <StackPanel x:Name="UserMenuPanel"
                  Grid.Column="2"
                  Orientation="Horizontal"
                  VerticalAlignment="Center"
                  Margin="0,0,8,0">
        <DropDownButton x:Name="UserMenuButton"
                        x:Uid="Shell.UserMenu"
                        VerticalAlignment="Center">
          <StackPanel Orientation="Horizontal">
            <FontIcon Glyph="&#xE77B;"
                      FontSize="16"
                      Margin="0,0,8,0" />
            <TextBlock x:Name="UserMenuText"
                       x:Uid="Shell.UserMenu.Text"
                       VerticalAlignment="Center" />
          </StackPanel>
          <DropDownButton.Flyout>
            <MenuFlyout Placement="BottomEdgeAlignedRight">
              <MenuFlyoutItem x:Name="MenuItemTenants"
                              x:Uid="Shell.UserMenu.Tenants"
                              Click="OnTenantsClick">
                <MenuFlyoutItem.Icon>
                  <FontIcon Glyph="&#xE902;" />
                </MenuFlyoutItem.Icon>
              </MenuFlyoutItem>
              <MenuFlyoutItem x:Name="MenuItemSuperadminTenants"
                              x:Uid="Shell.UserMenu.SuperadminTenants"
                              Click="OnSuperadminTenantsClick"
                              Visibility="Collapsed">
                <MenuFlyoutItem.Icon>
                  <FontIcon Glyph="&#xE7EE;" />
                </MenuFlyoutItem.Icon>
              </MenuFlyoutItem>
              <MenuFlyoutSeparator />
              <ToggleMenuFlyoutItem x:Name="MenuItemDarkMode"
                                    x:Uid="Shell.UserMenu.DarkMode"
                                    Click="OnDarkModeToggle">
                <ToggleMenuFlyoutItem.Icon>
                  <FontIcon Glyph="&#xE793;" />
                </ToggleMenuFlyoutItem.Icon>
              </ToggleMenuFlyoutItem>
              <MenuFlyoutSeparator />
              <MenuFlyoutItem x:Name="MenuItemLogout"
                              x:Uid="Shell.UserMenu.Logout"
                              Click="OnLogoutClick">
                <MenuFlyoutItem.Icon>
                  <FontIcon Glyph="&#xE7E8;" />
                </MenuFlyoutItem.Icon>
              </MenuFlyoutItem>
            </MenuFlyout>
          </DropDownButton.Flyout>
        </DropDownButton>
      </StackPanel>
    </Grid>

    <!-- Main Content Area with NavigationView -->
    <Grid Grid.Row="1">
      <NavigationView x:Name="NavView"
                      PaneDisplayMode="Left"
                      IsBackButtonVisible="Collapsed"
                      IsSettingsVisible="False"
                      IsPaneToggleButtonVisible="False"
                      OpenPaneLength="280"
                      CompactModeThresholdWidth="640"
                      ExpandedModeThresholdWidth="1000"
                      SelectionChanged="OnNavigationViewSelectionChanged"
                      DataContext="{Binding}">

        <!-- Navigation Menu Items -->
        <NavigationView.MenuItems>
          <!-- Login Menu Item (only visible when NOT authenticated) -->
          <NavigationViewItem x:Name="NavItemLogin"
                              x:Uid="Shell.NavItem.Login"
                              Tag="Login">
            <NavigationViewItem.Icon>
              <FontIcon Glyph="&#xE77B;" />
            </NavigationViewItem.Icon>
          </NavigationViewItem>

          <!-- Authenticated Menu Items -->
          <NavigationViewItem x:Name="NavItemDashboard"
                              x:Uid="Shell.NavItem.Dashboard"
                              Tag="Main">
            <NavigationViewItem.Icon>
              <FontIcon Glyph="&#xE80F;" />
            </NavigationViewItem.Icon>
          </NavigationViewItem>

          <NavigationViewItemSeparator x:Name="NavSeparator1" />

          <NavigationViewItem x:Name="NavItemCustomers"
                              x:Uid="Shell.NavItem.Customers"
                              Tag="Customers">
            <NavigationViewItem.Icon>
              <FontIcon Glyph="&#xE716;" />
            </NavigationViewItem.Icon>
          </NavigationViewItem>

          <NavigationViewItem x:Name="NavItemOrders"
                              x:Uid="Shell.NavItem.Orders"
                              Tag="Orders">
            <NavigationViewItem.Icon>
              <FontIcon Glyph="&#xE7BF;" />
            </NavigationViewItem.Icon>
          </NavigationViewItem>

          <NavigationViewItem x:Name="NavItemInvoices"
                              x:Uid="Shell.NavItem.Invoices"
                              Tag="Invoices">
            <NavigationViewItem.Icon>
              <FontIcon Glyph="&#xE9F9;" />
            </NavigationViewItem.Icon>
          </NavigationViewItem>

          <NavigationViewItem x:Name="NavItemProducts"
                              x:Uid="Shell.NavItem.Products"
                              Tag="Products">
            <NavigationViewItem.Icon>
              <FontIcon Glyph="&#xE7BF;" />
            </NavigationViewItem.Icon>
          </NavigationViewItem>

          <NavigationViewItem x:Name="NavItemManufacturers"
                              x:Uid="Shell.NavItem.Manufacturers"
                              Tag="Manufacturers">
            <NavigationViewItem.Icon>
              <FontIcon Glyph="&#xE8FD;" />
            </NavigationViewItem.Icon>
          </NavigationViewItem>

          <NavigationViewItem x:Name="NavItemWarehouses"
                              x:Uid="Shell.NavItem.Warehouses"
                              Tag="Warehouses">
            <NavigationViewItem.Icon>
              <FontIcon Glyph="&#xE913;" />
            </NavigationViewItem.Icon>
          </NavigationViewItem>

          <NavigationViewItem x:Name="NavItemSalesChannels"
                              x:Uid="Shell.NavItem.SalesChannels"
                              Tag="SalesChannels">
            <NavigationViewItem.Icon>
              <FontIcon Glyph="&#xE8A7;" />
            </NavigationViewItem.Icon>
          </NavigationViewItem>

          <NavigationViewItemSeparator x:Name="NavSeparator2" />

          <NavigationViewItem x:Name="NavItemAiModels"
                              x:Uid="Shell.NavItem.AiModels"
                              Tag="AiModels">
            <NavigationViewItem.Icon>
              <FontIcon Glyph="&#xE99A;" />
            </NavigationViewItem.Icon>
          </NavigationViewItem>

          <NavigationViewItem x:Name="NavItemAiPrompts"
                              x:Uid="Shell.NavItem.AiPrompts"
                              Tag="AiPrompts">
            <NavigationViewItem.Icon>
              <FontIcon Glyph="&#xE8BD;" />
            </NavigationViewItem.Icon>
          </NavigationViewItem>

          <NavigationViewItemSeparator x:Name="NavSeparator3" />

          <NavigationViewItem x:Name="NavItemTaxClasses"
                              x:Uid="Shell.NavItem.TaxClasses"
                              Tag="TaxClasses">
            <NavigationViewItem.Icon>
              <FontIcon Glyph="&#xE912;" />
            </NavigationViewItem.Icon>
          </NavigationViewItem>
        </NavigationView.MenuItems>

        <!-- Footer Menu Items removed - Settings and Logout moved to Header User Menu -->

        <!-- Content Area with ExtendedSplashScreen and TabBar -->
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>

          <!-- Main Content Area -->
          <Grid Grid.Row="0">
            <utu:ExtendedSplashScreen x:Name="Splash"
                                      HorizontalAlignment="Stretch"
                                      VerticalAlignment="Stretch"
                                      HorizontalContentAlignment="Stretch"
                                      VerticalContentAlignment="Stretch">
              <utu:ExtendedSplashScreen.LoadingContentTemplate>
                <DataTemplate>
                  <Grid>
                    <Grid.RowDefinitions>
                      <RowDefinition Height="2*" />
                      <RowDefinition />
                    </Grid.RowDefinitions>

                    <ProgressRing IsActive="True"
                                  Grid.Row="1"
                                  VerticalAlignment="Center"
                                  HorizontalAlignment="Center"
                                  Height="100"
                                  Width="100" />
                  </Grid>
                </DataTemplate>
              </utu:ExtendedSplashScreen.LoadingContentTemplate>
            </utu:ExtendedSplashScreen>
          </Grid>

          <!-- TabBar for Mobile (Bottom Navigation) -->
          <utu:TabBar x:Name="TabBarNav"
                      Grid.Row="1"
                      Visibility="Collapsed"
                      VerticalAlignment="Bottom"
                      Style="{StaticResource MaterialBottomTabBarStyle}">
            <utu:TabBar.Items>
              <!-- Login Tab (only visible when NOT authenticated) -->
              <utu:TabBarItem x:Name="TabItemLogin"
                              Style="{StaticResource MaterialBottomTabBarItemStyle}"
                              x:Uid="Shell.NavItem.Login"
                              Tag="Login">
                <utu:TabBarItem.Icon>
                  <FontIcon Glyph="&#xE77B;" />
                </utu:TabBarItem.Icon>
              </utu:TabBarItem>

              <!-- Authenticated Tabs -->
              <utu:TabBarItem x:Name="TabItemDashboard"
                              Style="{StaticResource MaterialBottomTabBarItemStyle}"
                              x:Uid="Shell.NavItem.Dashboard"
                              Tag="Main">
                <utu:TabBarItem.Icon>
                  <FontIcon Glyph="&#xE80F;" />
                </utu:TabBarItem.Icon>
              </utu:TabBarItem>

              <utu:TabBarItem x:Name="TabItemCustomers"
                              Style="{StaticResource MaterialBottomTabBarItemStyle}"
                              x:Uid="Shell.NavItem.Customers"
                              Tag="Customers">
                <utu:TabBarItem.Icon>
                  <FontIcon Glyph="&#xE716;" />
                </utu:TabBarItem.Icon>
              </utu:TabBarItem>

              <utu:TabBarItem x:Name="TabItemOrders"
                              Style="{StaticResource MaterialBottomTabBarItemStyle}"
                              x:Uid="Shell.NavItem.Orders"
                              Tag="Orders">
                <utu:TabBarItem.Icon>
                  <FontIcon Glyph="&#xE7BF;" />
                </utu:TabBarItem.Icon>
              </utu:TabBarItem>

              <utu:TabBarItem x:Name="TabItemSettings"
                              Style="{StaticResource MaterialBottomTabBarItemStyle}"
                              x:Uid="Shell.NavItem.Settings"
                              Tag="Settings">
                <utu:TabBarItem.Icon>
                  <FontIcon Glyph="&#xE713;" />
                </utu:TabBarItem.Icon>
              </utu:TabBarItem>

              <utu:TabBarItem x:Name="TabItemLogout"
                              Style="{StaticResource MaterialBottomTabBarItemStyle}"
                              x:Uid="Shell.NavItem.Logout"
                              Tag="Logout">
                <utu:TabBarItem.Icon>
                  <FontIcon Glyph="&#xE7E8;" />
                </utu:TabBarItem.Icon>
              </utu:TabBarItem>
            </utu:TabBar.Items>
          </utu:TabBar>
        </Grid>
      </NavigationView>
    </Grid>
  </Grid>
</UserControl>
