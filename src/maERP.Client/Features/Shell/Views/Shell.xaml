<UserControl x:Class="maERP.Client.Features.Shell.Views.Shell"
     xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
     xmlns:local="using:maERP.Client.Features.Shell.Views"
     xmlns:models="using:maERP.Client.Features.Shell.Models"
     xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
     xmlns:utu="using:Uno.Toolkit.UI"
     xmlns:uen="using:Uno.Extensions.Navigation.UI"
     mc:Ignorable="d"
     d:DesignHeight="768"
     d:DesignWidth="1200">

  <UserControl.Resources>
  </UserControl.Resources>

  <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <!-- VisualStateManager for responsive breakpoints -->
    <VisualStateManager.VisualStateGroups>
      <VisualStateGroup>
        <!-- Narrow: Mobile phones (< 700px) -->
        <VisualState x:Name="Narrow">
          <VisualState.Setters>
            <Setter Target="TabBarNav.Visibility" Value="Visible" />
            <Setter Target="NavView.IsPaneToggleButtonVisible" Value="False" />
            <Setter Target="NavView.PaneDisplayMode" Value="LeftMinimal" />
            <Setter Target="NavView.IsPaneOpen" Value="False" />
            <Setter Target="NavView.IsPaneVisible" Value="False" />
          </VisualState.Setters>
        </VisualState>

        <!-- Normal: Tablets (700px - 999px) -->
        <VisualState x:Name="Normal">
          <VisualState.StateTriggers>
            <AdaptiveTrigger MinWindowWidth="700" />
          </VisualState.StateTriggers>
          <VisualState.Setters>
            <Setter Target="TabBarNav.Visibility" Value="Collapsed" />
            <Setter Target="NavView.IsPaneToggleButtonVisible" Value="True" />
            <Setter Target="NavView.IsPaneVisible" Value="True" />
            <Setter Target="NavView.PaneDisplayMode" Value="Left" />
          </VisualState.Setters>
        </VisualState>

        <!-- Wide: Desktop (>= 1000px) -->
        <VisualState x:Name="Wide">
          <VisualState.StateTriggers>
            <AdaptiveTrigger MinWindowWidth="1000" />
          </VisualState.StateTriggers>
          <VisualState.Setters>
            <Setter Target="TabBarNav.Visibility" Value="Collapsed" />
            <Setter Target="NavView.IsPaneToggleButtonVisible" Value="True" />
            <Setter Target="NavView.IsPaneVisible" Value="True" />
            <Setter Target="NavView.PaneDisplayMode" Value="Left" />
            <Setter Target="NavView.IsPaneOpen" Value="True" />
          </VisualState.Setters>
        </VisualState>
      </VisualStateGroup>
    </VisualStateManager.VisualStateGroups>

    <NavigationView x:Name="NavView"
                    PaneDisplayMode="Left"
                    IsBackButtonVisible="Collapsed"
                    IsSettingsVisible="False"
                    IsPaneToggleButtonVisible="True"
                    OpenPaneLength="280"
                    CompactModeThresholdWidth="640"
                    ExpandedModeThresholdWidth="1000"
                    SelectionChanged="OnNavigationViewSelectionChanged"
                    DataContext="{Binding}">

      <!-- Navigation Menu Items -->
      <NavigationView.MenuItems>
        <!-- Login Menu Item (only visible when NOT authenticated) -->
        <NavigationViewItem x:Name="NavItemLogin"
                            x:Uid="Shell.NavItem.Login"
                            Tag="Login">
          <NavigationViewItem.Icon>
            <FontIcon Glyph="&#xE77B;" />
          </NavigationViewItem.Icon>
        </NavigationViewItem>

        <!-- Authenticated Menu Items -->
        <NavigationViewItem x:Name="NavItemDashboard"
                            x:Uid="Shell.NavItem.Dashboard"
                            Tag="Main">
          <NavigationViewItem.Icon>
            <FontIcon Glyph="&#xE80F;" />
          </NavigationViewItem.Icon>
        </NavigationViewItem>

        <NavigationViewItemSeparator x:Name="NavSeparator1" />

        <NavigationViewItemHeader x:Name="NavHeaderModules"
                                  x:Uid="Shell.NavHeader.Modules" />

        <NavigationViewItem x:Name="NavItemCustomers"
                            x:Uid="Shell.NavItem.Customers"
                            Tag="Customers">
          <NavigationViewItem.Icon>
            <FontIcon Glyph="&#xE716;" />
          </NavigationViewItem.Icon>
        </NavigationViewItem>

        <NavigationViewItem x:Name="NavItemOrders"
                            x:Uid="Shell.NavItem.Orders"
                            Tag="Orders">
          <NavigationViewItem.Icon>
            <FontIcon Glyph="&#xE7BF;" />
          </NavigationViewItem.Icon>
        </NavigationViewItem>

        <NavigationViewItem x:Name="NavItemProducts"
                            x:Uid="Shell.NavItem.Products"
                            Tag="Products">
          <NavigationViewItem.Icon>
            <FontIcon Glyph="&#xE7BF;" />
          </NavigationViewItem.Icon>
        </NavigationViewItem>

        <NavigationViewItem x:Name="NavItemInventory"
                            x:Uid="Shell.NavItem.Inventory"
                            Tag="Inventory">
          <NavigationViewItem.Icon>
            <FontIcon Glyph="&#xE8F1;" />
          </NavigationViewItem.Icon>
        </NavigationViewItem>
      </NavigationView.MenuItems>

      <!-- Footer Menu Items -->
      <NavigationView.FooterMenuItems>
        <NavigationViewItem x:Name="NavItemSettings"
                            x:Uid="Shell.NavItem.Settings"
                            Tag="Settings">
          <NavigationViewItem.Icon>
            <FontIcon Glyph="&#xE713;" />
          </NavigationViewItem.Icon>
        </NavigationViewItem>

        <NavigationViewItem x:Name="NavItemLogout"
                            x:Uid="Shell.NavItem.Logout"
                            Tag="Logout">
          <NavigationViewItem.Icon>
            <FontIcon Glyph="&#xE7E8;" />
          </NavigationViewItem.Icon>
        </NavigationViewItem>
      </NavigationView.FooterMenuItems>

      <!-- Content Area with ExtendedSplashScreen and TabBar -->
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="*" />
          <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Main Content Area -->
        <Grid Grid.Row="0">
          <utu:ExtendedSplashScreen x:Name="Splash"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Stretch"
                                    HorizontalContentAlignment="Stretch"
                                    VerticalContentAlignment="Stretch">
            <utu:ExtendedSplashScreen.LoadingContentTemplate>
              <DataTemplate>
                <Grid>
                  <Grid.RowDefinitions>
                    <RowDefinition Height="2*" />
                    <RowDefinition />
                  </Grid.RowDefinitions>

                  <ProgressRing IsActive="True"
                                Grid.Row="1"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Height="100"
                                Width="100" />
                </Grid>
              </DataTemplate>
            </utu:ExtendedSplashScreen.LoadingContentTemplate>
          </utu:ExtendedSplashScreen>
        </Grid>

        <!-- TabBar for Mobile (Bottom Navigation) -->
        <utu:TabBar x:Name="TabBarNav"
                    Grid.Row="1"
                    Visibility="Collapsed"
                    VerticalAlignment="Bottom"
                    Style="{StaticResource MaterialBottomTabBarStyle}">
          <utu:TabBar.Items>
            <!-- Login Tab (only visible when NOT authenticated) -->
            <utu:TabBarItem x:Name="TabItemLogin"
                            Style="{StaticResource MaterialBottomTabBarItemStyle}"
                            x:Uid="Shell.NavItem.Login"
                            Tag="Login">
              <utu:TabBarItem.Icon>
                <FontIcon Glyph="&#xE77B;" />
              </utu:TabBarItem.Icon>
            </utu:TabBarItem>

            <!-- Authenticated Tabs -->
            <utu:TabBarItem x:Name="TabItemDashboard"
                            Style="{StaticResource MaterialBottomTabBarItemStyle}"
                            x:Uid="Shell.NavItem.Dashboard"
                            Tag="Main">
              <utu:TabBarItem.Icon>
                <FontIcon Glyph="&#xE80F;" />
              </utu:TabBarItem.Icon>
            </utu:TabBarItem>

            <utu:TabBarItem x:Name="TabItemCustomers"
                            Style="{StaticResource MaterialBottomTabBarItemStyle}"
                            x:Uid="Shell.NavItem.Customers"
                            Tag="Customers">
              <utu:TabBarItem.Icon>
                <FontIcon Glyph="&#xE716;" />
              </utu:TabBarItem.Icon>
            </utu:TabBarItem>

            <utu:TabBarItem x:Name="TabItemOrders"
                            Style="{StaticResource MaterialBottomTabBarItemStyle}"
                            x:Uid="Shell.NavItem.Orders"
                            Tag="Orders">
              <utu:TabBarItem.Icon>
                <FontIcon Glyph="&#xE7BF;" />
              </utu:TabBarItem.Icon>
            </utu:TabBarItem>

            <utu:TabBarItem x:Name="TabItemSettings"
                            Style="{StaticResource MaterialBottomTabBarItemStyle}"
                            x:Uid="Shell.NavItem.Settings"
                            Tag="Settings">
              <utu:TabBarItem.Icon>
                <FontIcon Glyph="&#xE713;" />
              </utu:TabBarItem.Icon>
            </utu:TabBarItem>

            <utu:TabBarItem x:Name="TabItemLogout"
                            Style="{StaticResource MaterialBottomTabBarItemStyle}"
                            x:Uid="Shell.NavItem.Logout"
                            Tag="Logout">
              <utu:TabBarItem.Icon>
                <FontIcon Glyph="&#xE7E8;" />
              </utu:TabBarItem.Icon>
            </utu:TabBarItem>
          </utu:TabBar.Items>
        </utu:TabBar>
      </Grid>
    </NavigationView>
  </Grid>
</UserControl>
