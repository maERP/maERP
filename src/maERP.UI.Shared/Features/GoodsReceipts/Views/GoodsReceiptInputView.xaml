<UserControl
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
    x:Class="maERP.UI.Shared.Features.GoodsReceipts.Views.GoodsReceiptInputView">

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Simple Header -->
    <Grid Grid.Row="0" Margin="0,0,0,32">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>

      <!-- Title -->
      <StackPanel Grid.Column="0" VerticalAlignment="Center">
        <TextBlock Text="{Binding PageTitle}"
                   FontSize="28"
                   FontWeight="SemiBold"
                   Foreground="{ThemeResource ContentViewHeadingBrush}"
                   Margin="0,0,0,8"/>
        <TextBlock Text="Wareneingänge schnell und einfach erfassen"
                   FontSize="14"
                   Foreground="{ThemeResource ContentViewSubheadingBrush}"/>
      </StackPanel>

      <!-- Action buttons -->
      <StackPanel Grid.Column="1"
                  Orientation="Horizontal"
                  Spacing="8"
                  VerticalAlignment="Center">
        <Button Content="◀️"
                Command="{Binding GoBackCommand}"
                Padding="12,8"
                CornerRadius="{ThemeResource CornerRadiusS}"
                FontSize="16"
                Background="{ThemeResource SurfaceContainerBrush}"
                Foreground="{ThemeResource OnSurfaceBrush}"
                BorderThickness="0"
                ToolTipService.ToolTip="Zurück"/>
      </StackPanel>
    </Grid>

    <!-- Main content -->
    <Grid Grid.Row="1">

      <!-- Loading Indicator -->
      <StackPanel Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                  VerticalAlignment="Center"
                  HorizontalAlignment="Center"
                  Spacing="16">
        <ProgressRing IsActive="True" Width="40" Height="40"/>
        <TextBlock Text="Daten werden geladen..."
                   HorizontalAlignment="Center"
                   Opacity="0.7"/>
      </StackPanel>

      <!-- Success/Error Messages -->
      <StackPanel Margin="24,16,24,0" Spacing="8">

        <!-- Success Message -->
        <Border Visibility="{Binding SuccessMessage, Converter={StaticResource NullToVisibilityConverter}}"
                Background="#D4EDDA"
                BorderBrush="#C3E6CB"
                BorderThickness="1"
                CornerRadius="{ThemeResource CornerRadiusM}"
                Padding="16">
          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBlock Text="✅" FontSize="16"/>
            <TextBlock Text="{Binding SuccessMessage}"
                       Foreground="#155724"
                       FontWeight="SemiBold"/>
          </StackPanel>
        </Border>

        <!-- Error Message -->
        <Border Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}}"
                Background="#F8D7DA"
                BorderBrush="#F5C6CB"
                BorderThickness="1"
                CornerRadius="{ThemeResource CornerRadiusM}"
                Padding="16">
          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBlock Text="❌" FontSize="16"/>
            <TextBlock Text="{Binding ErrorMessage}"
                       Foreground="#721C24"
                       FontWeight="SemiBold"/>
          </StackPanel>
        </Border>

      </StackPanel>

      <!-- Form Content -->
      <ScrollViewer Visibility="{Binding ShouldShowContent, Converter={StaticResource BoolToVisibilityConverter}}" Margin="24,16,24,16">
        <StackPanel Spacing="20" MaxWidth="800" HorizontalAlignment="Center">

          <!-- Wareneingang Formular -->
          <Border Background="{ThemeResource ControlFillColorDefaultBrush}"
                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                  BorderThickness="1"
                  CornerRadius="{ThemeResource CornerRadiusL}"
                  Padding="32">
            <StackPanel Spacing="24">

              <!-- Section Title -->
              <TextBlock Text="📦📥 Wareneingang erfassen"
                         FontSize="20"
                         FontWeight="SemiBold"
                         Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                         HorizontalAlignment="Center"/>

              <!-- Form Fields -->
              <Grid ColumnSpacing="24" RowSpacing="20">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Row 1: Datum, Lager -->
                <StackPanel Grid.Row="0" Grid.Column="0" Spacing="6">
                  <TextBlock Text="📅 Datum" FontWeight="SemiBold" FontSize="14"/>
                  <DatePicker SelectedDate="{Binding ReceiptDate, Mode=TwoWay}"
                             CornerRadius="{ThemeResource CornerRadiusM}"
                             Padding="12,10"/>
                </StackPanel>

                <StackPanel Grid.Row="0" Grid.Column="1" Spacing="6">
                  <TextBlock Text="🏪 Lager *" FontWeight="SemiBold" FontSize="14"/>
                  <ComboBox ItemsSource="{Binding AvailableWarehouses}"
                           SelectedItem="{Binding SelectedWarehouse, Mode=TwoWay}"
                           DisplayMemberPath="Name"
                           CornerRadius="{ThemeResource CornerRadiusM}"
                           Padding="12,10"
                           HorizontalAlignment="Stretch"/>
                </StackPanel>

                <!-- Row 2: Produkt (spans both columns) -->
                <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Spacing="6">
                  <TextBlock Text="📦 Produkt *" FontWeight="SemiBold" FontSize="14"/>
                  <ComboBox ItemsSource="{Binding AvailableProducts}"
                           SelectedItem="{Binding SelectedProduct, Mode=TwoWay}"
                           DisplayMemberPath="Name"
                           CornerRadius="{ThemeResource CornerRadiusM}"
                           Padding="12,10"
                           IsTextSearchEnabled="True"
                           HorizontalAlignment="Stretch"/>
                </StackPanel>

                <!-- Row 3: Menge, Lieferant -->
                <StackPanel Grid.Row="2" Grid.Column="0" Spacing="6">
                  <TextBlock Text="📊 Menge *" FontWeight="SemiBold" FontSize="14"/>
                  <NumberBox Value="{Binding Quantity, Mode=TwoWay}"
                            Minimum="1"
                            Maximum="999999"
                            SmallChange="1"
                            CornerRadius="{ThemeResource CornerRadiusM}"
                            SpinButtonPlacementMode="Inline"
                            FontSize="16"
                            FontWeight="SemiBold"/>
                </StackPanel>

                <StackPanel Grid.Row="2" Grid.Column="1" Spacing="6">
                  <TextBlock Text="🚚 Lieferant" FontWeight="SemiBold" FontSize="14"/>
                  <TextBox Text="{Binding Supplier, Mode=TwoWay}"
                           PlaceholderText="Lieferant eingeben (optional)..."
                           CornerRadius="{ThemeResource CornerRadiusM}"
                           Padding="12,10"/>
                </StackPanel>

                <!-- Row 4: Notizen (spans both columns) -->
                <StackPanel Grid.Row="3" Grid.ColumnSpan="2" Spacing="6">
                  <TextBlock Text="📝 Notizen" FontWeight="SemiBold" FontSize="14"/>
                  <TextBox Text="{Binding Notes, Mode=TwoWay}"
                           PlaceholderText="Notizen zum Wareneingang (optional)..."
                           CornerRadius="{ThemeResource CornerRadiusM}"
                           Padding="12,10"
                           Height="80"
                           AcceptsReturn="True"
                           TextWrapping="Wrap"/>
                </StackPanel>

                <!-- Row 5: Action Buttons (spans both columns) -->
                <StackPanel Grid.Row="4" Grid.ColumnSpan="2"
                           Orientation="Horizontal"
                           Spacing="12"
                           HorizontalAlignment="Center"
                           Margin="0,16,0,0">

                  <Button Content="💾 Speichern"
                          Command="{Binding SaveGoodsReceiptCommand}"
                          IsEnabled="{Binding IsSaving, Converter={StaticResource InverseBoolConverter}}"
                          Padding="24,12"
                          CornerRadius="{ThemeResource CornerRadiusM}"
                          FontSize="16"
                          FontWeight="SemiBold"
                          Background="{ThemeResource AccentFillColorDefaultBrush}"
                          Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                          MinWidth="140"/>

                  <Button Content="💾➕ Speichern und Nächster"
                          Command="{Binding SaveAndNewGoodsReceiptCommand}"
                          IsEnabled="{Binding IsSaving, Converter={StaticResource InverseBoolConverter}}"
                          Padding="24,12"
                          CornerRadius="{ThemeResource CornerRadiusM}"
                          FontSize="16"
                          FontWeight="SemiBold"
                          Background="{ThemeResource SystemFillColorSuccessBrush}"
                          Foreground="{ThemeResource OnPrimaryBrush}"
                          MinWidth="200"
                          ToolTipService.ToolTip="Speichert den aktuellen Wareneingang und bereitet das Formular für den nächsten vor"/>

                </StackPanel>

              </Grid>

            </StackPanel>
          </Border>

          <!-- Quick Guide Card -->
          <Border Background="{ThemeResource LayerFillColorAltBrush}"
                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                  BorderThickness="1"
                  CornerRadius="{ThemeResource CornerRadiusM}"
                  Padding="20">
            <StackPanel Spacing="12">

              <TextBlock Text="💡 Schnell-Anleitung"
                         FontSize="16"
                         FontWeight="SemiBold"
                         Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>

              <TextBlock TextWrapping="Wrap"
                         Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                         LineHeight="1.4">
                <Run Text="• Wählen Sie zuerst das Lager aus, in das die Waren eingelagert werden sollen."/>
                <LineBreak/>
                <Run Text="• Suchen Sie das Produkt über die Produktauswahl (Sie können tippen um zu suchen)."/>
                <LineBreak/>
                <Run Text="• Geben Sie die Menge ein und optional den Lieferanten."/>
                <LineBreak/>
                <Run Text="• Verwenden Sie 'Speichern und Nächster' für schnelle Mehrfacherfassung."/>
              </TextBlock>

            </StackPanel>
          </Border>

        </StackPanel>
      </ScrollViewer>

    </Grid>

    <!-- Footer with saving indicator -->
    <Border Grid.Row="2"
            Background="{ThemeResource ControlFillColorDefaultBrush}"
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="0,1,0,0"
            CornerRadius="0,0,8,8"
            Padding="24,12"
            Visibility="{Binding IsSaving, Converter={StaticResource BoolToVisibilityConverter}}">

      <StackPanel Orientation="Horizontal"
                  Spacing="12"
                  HorizontalAlignment="Center">
        <ProgressRing IsActive="True" Width="20" Height="20"/>
        <TextBlock Text="Wareneingang wird gespeichert..."
                   VerticalAlignment="Center"
                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
      </StackPanel>

    </Border>

  </Grid>

</UserControl>
