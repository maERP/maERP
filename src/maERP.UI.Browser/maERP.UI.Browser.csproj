<Project Sdk="Microsoft.NET.Sdk.WebAssembly">
  <PropertyGroup>
    <TargetFramework>net9.0-browser</TargetFramework>
    <OutputType>Exe</OutputType>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <WasmBuildNative>true</WasmBuildNative>
    <RunAOTCompilation>false</RunAOTCompilation>
    <WasmNativeStrip>false</WasmNativeStrip>
    <ShouldIncludeNativeSkiaSharp>false</ShouldIncludeNativeSkiaSharp>
    <ShouldIncludeNativeHarfBuzzSharp>false</ShouldIncludeNativeHarfBuzzSharp>
    <!-- Disable trimming to prevent issues with Avalonia DataTemplates and Reflection -->
    <PublishTrimmed>false</PublishTrimmed>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Avalonia.Browser" Version="11.3.7" />
    <PackageReference Include="System.Private.Uri" Version="4.3.2" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\maERP.UI\maERP.UI.csproj" />
  </ItemGroup>

  <ItemGroup>
    <NativeFileReference Include="$(SkiaSharpStaticLibraryPath)\3.1.34\st\*.a"
                         Condition="'$(WasmEnableThreads)' != 'True' and '$(WasmEnableSIMD)' != 'True'" />
    <NativeFileReference Include="$(SkiaSharpStaticLibraryPath)\3.1.34\simd,st\*.a"
                         Condition="'$(WasmEnableThreads)' != 'True' and '$(WasmEnableSIMD)' == 'True'" />
    <NativeFileReference Include="$(SkiaSharpStaticLibraryPath)\3.1.34\mt\*.a"
                         Condition="'$(WasmEnableThreads)' == 'True' and '$(WasmEnableSIMD)' != 'True'" />
    <NativeFileReference Include="$(SkiaSharpStaticLibraryPath)\3.1.34\simd,mt\*.a"
                         Condition="'$(WasmEnableThreads)' == 'True' and '$(WasmEnableSIMD)' == 'True'" />

    <NativeFileReference Include="$(HarfBuzzSharpStaticLibraryPath)\3.1.34\st\*.a"
                         Condition="'$(WasmEnableThreads)' != 'True' and '$(WasmEnableSIMD)' != 'True'" />
    <NativeFileReference Include="$(HarfBuzzSharpStaticLibraryPath)\3.1.34\st,simd\*.a"
                         Condition="'$(WasmEnableThreads)' != 'True' and '$(WasmEnableSIMD)' == 'True'" />
    <NativeFileReference Include="$(HarfBuzzSharpStaticLibraryPath)\3.1.34\mt\*.a"
                         Condition="'$(WasmEnableThreads)' == 'True' and '$(WasmEnableSIMD)' != 'True'" />
    <NativeFileReference Include="$(HarfBuzzSharpStaticLibraryPath)\3.1.34\mt,simd\*.a"
                         Condition="'$(WasmEnableThreads)' == 'True' and '$(WasmEnableSIMD)' == 'True'" />
    <NativeFileReference Remove="..\..\..\..\..\.nuget\packages\skiasharp.nativeassets.webassembly\2.88.9\build\netstandard1.0\libSkiaSharp.a\3.1.34\simd,st\**" />
    <NativeFileReference Remove="..\..\..\..\..\.nuget\packages\harfbuzzsharp.nativeassets.webassembly\8.3.1.1\buildTransitive\netstandard1.0\libHarfBuzzSharp.a\3.1.34\st,simd\**" />
  </ItemGroup>
</Project>